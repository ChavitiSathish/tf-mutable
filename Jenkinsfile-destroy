pipeline {
  agent any
  parameters {
    choice(name: 'ACTION', choices: ['dev-destroy', 'prod-destroy'], description: 'Choose Environment')
  }
  stages {
    stage('Components Destroy') {
          parallel {
            stage('CART Destroy') {
              steps {
                 dir('cart') {
                     sh '''
                       git clone https://chavitisathish@dev.azure.com/chavitisathish/devops-project/_git/cart .
                       cd terraform-mutable
                       make ${ACTION}
                     '''
                 }
              }
            }

            stage('CATALOGUE Destroy') {
              steps {
                dir('catalogue') {
                     sh '''
                       git clone https://chavitisathish@dev.azure.com/chavitisathish/devops-project/_git/catalogue .
                       cd terraform-mutable
                       make ${ACTION}
                     '''
                }
              }
            }

            stage('FRONTEND Destroy') {
              steps {
                dir('frontend') {
                    sh '''
                       git clone https://chavitisathish@dev.azure.com/chavitisathish/devops-project/_git/frontend .
                       cd terraform-mutable
                       make ${ACTION}
                    '''
                }
              }
            }

            stage('USER Destroy') {
              steps {
                dir('user') {
                    sh '''
                       git clone https://chavitisathish@dev.azure.com/chavitisathish/devops-project/_git/user .
                       cd terraform-mutable
                       make ${ACTION}
                    '''
                }
              }
            }

            stage('SHIPPING Destroy') {
              steps {
                dir('shipping') {
                    sh '''
                       git clone https://chavitisathish@dev.azure.com/chavitisathish/devops-project/_git/shipping .
                       cd terraform-mutable
                       make ${ACTION}
                    '''
                }
              }
            }
          }
        }


    stage('ALB Destroy') {
          steps {
            sh '''
              cd alb
              make ${ACTION}
            '''
          }
        }

    stage('DB Destroy') {
      steps {
        sh '''
          cd databases
          make ${ACTION}
        '''
      }
    }

    stage('VPC Destroy') {
      steps {
        sh '''
          cd vpc
          make ${ACTION}
        '''
      }
    }

  }

  post {
    always {
      cleanWs()
    }
  }

}

